import type { CryptoTableRow } from './types.ts'

function createSparkline(length = 21, start = 120, volatility = 3): number[] {
  const points: number[] = []
  let v = start
  for (let i = 0; i < length; i += 1) {
    const step = (Math.random() * 2 - 1) * volatility
    v = Math.max(1, v + step)
    points.push(Number(v.toFixed(2)))
  }
  return points
}

export const initialCryptoRows: CryptoTableRow[] = [
  {
    rank: 1,
    name: 'Bitcoin',
    symbol: 'BTC',
    image: '/cdn/image/BTC.png',
    price: '$50,355.21',
    ch24h: '6.49%',
    ch24h_direction: 'up',
    ch7d: '22.53%',
    ch7d_direction: 'up',
    marketCap: '$766,432,564,346',
    volume24h: '$38,544,965,954',
    spark: createSparkline(21, 120, 3),
  },
  {
    rank: 2,
    name: 'Ethereum',
    symbol: 'ETH',
    image: '/cdn/image/ETH.png',
    price: '$2,584.55',
    ch24h: '2.49%',
    ch24h_direction: 'up',
    ch7d: '22.53%',
    ch7d_direction: 'down',
    marketCap: '$285,843,885,844',
    volume24h: '$24,954,954,953',
    spark: createSparkline(21, 115, 3),
  },
  {
    rank: 3,
    name: 'Tether',
    symbol: 'USDT',
    image: '/cdn/image/USDT.png',
    price: '$1.00',
    ch24h: '0.12%',
    ch24h_direction: 'down',
    ch7d: '0.05%',
    ch7d_direction: 'up',
    marketCap: '$112,000,000,000',
    volume24h: '$56,000,000,000',
    spark: createSparkline(21, 100, 0.5),
  },
  {
    rank: 4,
    name: 'Cardano',
    symbol: 'ADA',
    image: '/cdn/image/ADA.png',
    price: '$0.62',
    ch24h: '1.22%',
    ch24h_direction: 'up',
    ch7d: '3.10%',
    ch7d_direction: 'up',
    marketCap: '$21,500,000,000',
    volume24h: '$850,000,000',
    spark: createSparkline(21, 62, 2.5),
  },
  {
    rank: 5,
    name: 'Bitcoin Cash',
    symbol: 'BCH',
    image: '/cdn/image/BCH.png',
    price: '$418.54',
    ch24h: '0.85%',
    ch24h_direction: 'up',
    ch7d: '4.12%',
    ch7d_direction: 'up',
    marketCap: '$8,200,000,000',
    volume24h: '$320,000,000',
    spark: createSparkline(21, 120, 3),
  },
  {
    rank: 6,
    name: 'Litecoin',
    symbol: 'LTC',
    image: '/cdn/image/LTC.png',
    price: '$74.22',
    ch24h: '1.45%',
    ch24h_direction: 'up',
    ch7d: '2.70%',
    ch7d_direction: 'up',
    marketCap: '$5,300,000,000',
    volume24h: '$240,000,000',
    spark: createSparkline(21, 95, 2.5),
  },
  {
    rank: 7,
    name: 'Dogecoin',
    symbol: 'DOGE',
    image: '/cdn/image/DOGE.png',
    price: '$0.12',
    ch24h: '2.02%',
    ch24h_direction: 'down',
    ch7d: '5.12%',
    ch7d_direction: 'up',
    marketCap: '$17,400,000,000',
    volume24h: '$1,100,000,000',
    spark: createSparkline(21, 45, 4),
  },
  {
    rank: 8,
    name: 'Solana',
    symbol: 'SOL',
    image: '/cdn/image/SOL.png',
    price: '$142.10',
    ch24h: '1.75%',
    ch24h_direction: 'up',
    ch7d: '6.10%',
    ch7d_direction: 'up',
    marketCap: '$63,000,000,000',
    volume24h: '$2,300,000,000',
    spark: createSparkline(21, 130, 3),
  },
  {
    rank: 9,
    name: 'Uniswap',
    symbol: 'UNI',
    image: '/cdn/image/UNI.png',
    price: '$8.42',
    ch24h: '0.95%',
    ch24h_direction: 'down',
    ch7d: '3.80%',
    ch7d_direction: 'up',
    marketCap: '$4,800,000,000',
    volume24h: '$180,000,000',
    spark: createSparkline(21, 85, 2.5),
  },
  {
    rank: 10,
    name: 'Shiba Inu',
    symbol: 'SHIB',
    image: '/cdn/image/SHIB.png',
    price: '$0.00002',
    ch24h: '3.10%',
    ch24h_direction: 'up',
    ch7d: '8.20%',
    ch7d_direction: 'up',
    marketCap: '$9,100,000,000',
    volume24h: '$420,000,000',
    spark: createSparkline(21, 35, 5),
  },
  {
    rank: 11,
    name: 'Toncoin',
    symbol: 'TON',
    image: '/cdn/image/TON.png',
    price: '$6.20',
    ch24h: '0.62%',
    ch24h_direction: 'down',
    ch7d: '2.20%',
    ch7d_direction: 'up',
    marketCap: '$21,000,000,000',
    volume24h: '$500,000,000',
    spark: createSparkline(21, 70, 2.2),
  },
  {
    rank: 12,
    name: 'Stellar',
    symbol: 'XLM',
    image: '/cdn/image/XLM.png',
    price: '$0.12',
    ch24h: '0.35%',
    ch24h_direction: 'up',
    ch7d: '1.40%',
    ch7d_direction: 'up',
    marketCap: '$3,400,000,000',
    volume24h: '$120,000,000',
    spark: createSparkline(21, 55, 2),
  },
  {
    rank: 13,
    name: 'Sui',
    symbol: 'SUI',
    image: '/cdn/image/SUI.png',
    price: '$1.39',
    ch24h: '1.10%',
    ch24h_direction: 'down',
    ch7d: '2.40%',
    ch7d_direction: 'up',
    marketCap: '$1,800,000,000',
    volume24h: '$95,000,000',
    spark: createSparkline(21, 60, 2.5),
  },
  {
    rank: 14,
    name: 'Radworks',
    symbol: 'RAD',
    image: '/cdn/image/RAD.png',
    price: '$2.45',
    ch24h: '0.70%',
    ch24h_direction: 'up',
    ch7d: '1.95%',
    ch7d_direction: 'up',
    marketCap: '$120,000,000',
    volume24h: '$9,000,000',
    spark: createSparkline(21, 60, 2.5),
  },
  {
    rank: 15,
    name: 'PROVE',
    symbol: 'PROVE',
    image: '/cdn/image/PROVE.png',
    price: '$0.12',
    ch24h: '2.10%',
    ch24h_direction: 'down',
    ch7d: '4.40%',
    ch7d_direction: 'up',
    marketCap: '$15,000,000',
    volume24h: '$1,200,000',
    spark: createSparkline(21, 45, 4),
  },
  {
    rank: 16,
    name: 'PENGU',
    symbol: 'PENGU',
    image: '/cdn/image/PENGU.png',
    price: '$0.03',
    ch24h: '1.10%',
    ch24h_direction: 'up',
    ch7d: '3.10%',
    ch7d_direction: 'up',
    marketCap: '$8,000,000',
    volume24h: '$600,000',
    spark: createSparkline(21, 40, 4),
  },
  {
    rank: 17,
    name: 'Magic',
    symbol: 'MAGIC',
    image: '/cdn/image/MAGIC.png',
    price: '$0.85',
    ch24h: '1.45%',
    ch24h_direction: 'down',
    ch7d: '5.10%',
    ch7d_direction: 'up',
    marketCap: '$250,000,000',
    volume24h: '$20,000,000',
    spark: createSparkline(21, 75, 3.2),
  },
  {
    rank: 18,
    name: 'Pepe',
    symbol: 'PEPE',
    image: '/cdn/image/PEPE.png',
    price: '$0.00001',
    ch24h: '4.20%',
    ch24h_direction: 'up',
    ch7d: '9.50%',
    ch7d_direction: 'up',
    marketCap: '$4,500,000,000',
    volume24h: '$650,000,000',
    spark: createSparkline(21, 30, 5),
  },
  {
    rank: 19,
    name: 'Popcat',
    symbol: 'POPCAT',
    image: '/cdn/image/POPCAT.png',
    price: '$0.20',
    ch24h: '3.40%',
    ch24h_direction: 'down',
    ch7d: '7.10%',
    ch7d_direction: 'up',
    marketCap: '$120,000,000',
    volume24h: '$9,500,000',
    spark: createSparkline(21, 50, 4.5),
  },
  {
    rank: 20,
    name: 'Meme',
    symbol: 'MEME',
    image: '/cdn/image/MEME.png',
    price: '$0.02',
    ch24h: '1.10%',
    ch24h_direction: 'down',
    ch7d: '2.70%',
    ch7d_direction: 'up',
    marketCap: '$20,000,000',
    volume24h: '$1,700,000',
    spark: createSparkline(21, 42, 3.8),
  },
  {
    rank: 21,
    name: 'dogwifhat',
    symbol: 'WIF',
    image: '/cdn/image/WIF.png',
    price: '$2.45',
    ch24h: '2.40%',
    ch24h_direction: 'up',
    ch7d: '6.30%',
    ch7d_direction: 'up',
    marketCap: '$2,400,000,000',
    volume24h: '$180,000,000',
    spark: createSparkline(21, 80, 4),
  },
  {
    rank: 22,
    name: 'TRUMP',
    symbol: 'TRUMP',
    image: '/cdn/image/TRUMP.png',
    price: '$7.10',
    ch24h: '3.10%',
    ch24h_direction: 'down',
    ch7d: '4.80%',
    ch7d_direction: 'up',
    marketCap: '$500,000,000',
    volume24h: '$40,000,000',
    spark: createSparkline(21, 95, 3.5),
  },
]

export function mutateRow(row: CryptoTableRow): CryptoTableRow {
  const delta = (Math.random() - 0.5) * 1.0
  const priceNum = Number(row.price.replace(/[$,]/g, ''))
  const newPrice = Math.max(0.01, priceNum + priceNum * (delta / 100))
  const ch24 = delta
  const ch7 = delta * 2
  const direction24 = ch24 >= 0 ? 'up' : 'down'
  const direction7 = ch7 >= 0 ? 'up' : 'down'
  const last = row.spark[row.spark.length - 1]
  const rawStep = (Math.random() * 2 - 1) * 2.5
  const step = Math.sign(rawStep || 1) * Math.max(Math.abs(rawStep), 0.8)
  const nextPoint = Math.max(1, last + step)
  const nextSpark = [...row.spark.slice(1), nextPoint]
  return {
    ...row,
    image: row.image,
    price: `$${newPrice.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`,
    ch24h: `${Math.abs(ch24).toFixed(2)}%`,
    ch24h_direction: direction24,
    ch7d: `${Math.abs(ch7).toFixed(2)}%`,
    ch7d_direction: direction7,
    spark: nextSpark,
  }
}
